trigger:
- master

pool:
  vmImage: 'windows-latest'

name: '1.0.$(Rev:r)'

steps:
- powershell: |
   Copy-Item LICENSE.md src
   Copy-Item README.md src
   Set-Location src\task\scripts
   New-Item -ItemType Directory ps_modules
   Set-Location ps_modules
   Save-Module -Name VstsTaskSdk -RequiredVersion 0.11.0 -Path .
   Save-Module -Name MicrosoftPowerBIMgmt.Profile -Path .
   Move-Item VstsTaskSdk\0.11.0 .
   Remove-Item VstsTaskSdk
   Rename-Item 0.11.0 VstsTaskSdk
  displayName: 'Prepare Extension'

- task: TfxInstaller@2
  displayName: 'Install TFX'

- task: PackageAzureDevOpsExtension@2
  displayName: 'Package Extension'
  inputs:
    rootFolder: '$(Build.SourcesDirectory)\src'
    outputPath: '$(Build.StagingDirectory)\bguidinger.powerbi-build-tools-$(Build.BuildNumber).vsix'
    extensionVersion: $(Build.BuildNumber)
    updateTasksVersion: true
    extensionPricing: free
    extensionVisibility: private

- task: PublishBuildArtifacts@1
  displayName: 'Publish Build Artifacts'